{% extends 'base.html.twig' %}

{% block content %}

    <style>
        * {
            /*font-family: Georgia, Times, 'Times New Roman', serif;*/
            font-family: 'Times New Roman';
        }
            body
            {
                
            }
            .sidebar
            {
                background-color: teal;
                width: 100%;
                top: 0;
                left: 0;
                padding:1%;
                position:relative;
                
            }
            a
            {
               
                text-decoration: none;
               
            }
            a:hover
            {
                color:white;
                text-decoration:none;
               
            }
            .accueil
            {
                color:white;
                text-decoration:none;
                font-size:1.7rem;
                
            }
            .accueil:hover
            {
                color:white;
                text-decoration:none;
               
            }
            .formulaire 
            {
                color: black;
                margin-top:1%;
                margin-left:11%;
                width:80%;
                border:solid white 1px;
               
            }
            #ouvrir
            {
                color:white;
                text-decoration:none;
                margin-left:75%;
                font-size:1.2rem;
                color:white;
               
            }
            #ouvrir:hover
                {
                    color:white;
                    text-decoration:none;
                    
                }
            #index
            {
                color: white;
                margin-top:2%;
                margin-left:74%;
                
            }
            h2
            {
                margin-left:10%;
                
            }
            .piece
            {
                margin-top:5%;
                
            }
            .foot
            {
               
               
            }
            {# .valider
            {
                margin-right:90%;
            } #}
            #supprimer
            {
                margin-left:2%;
               
            }
            {# #physiquebundle_physique_tuteur
            {
                cursor: no-drop;
            }
            #physiquebundle_physique_prenomTuteur
            {
                cursor: no-drop;
            } #}
            {# #editform_mineur {
                display:none;
            }  #}
            {# #prenom_tuteur {
                display:none;
            } #}
            #ajout
            {
                margin-left:97%;
               
            }
            #information
            {
                
            }
            tr
            {
                font-size:95%;
            }
            #valider
            {
                margin-left:80%;
            }
            #table 
            {
                margin-left:3%;
            }
            #ajout:hover
            {
                color:white;
            }
            #notification
            {
               margin-left:10%;
            }
    </style>

    {% block sidebar %}
        <div class="sidebar">
        <div class="row cl">
        <div class="col-md-2">
            <a href="{{path('path_home')}}" class="accueil">Accueil</a>
        </div>
        <div class="col-md-4">
    <a data-target="{{ path('physique_showMessage', { 'id': physique.id }) }}" data-tooltip="voir" class="tooltipped modal-trigger btn btn-outline-light my-6 my-sm-6" href="#modalNotif" id="notification" data-toggle="modal"><i class="fa fa-bell"></i><span class="badge" style="position: absolute;
top: -10px;padding: 5px 10px;border-radius: 50%;background:red;color: white;" id="notific">{{ comptesNotifs }}</span></a>
            {# <button type="button" class="btn btn-outline-light my-6 my-sm-6" id="notification" data-toggle="modal"><i class="fa fa-bell"></i><span class="badge" style="position: absolute;
            top: -10px;padding: 5px 10px;border-radius: 50%;background:red;color: white;" ></span></button> #}
        </div>
        <div class="col-md-6">
            <a href="{{ path('path_choix')}}" id="ouvrir">Ouvrir un compte</a>
        </div>
    </div>
        </div>
        </div>
    {% endblock %}

            <a href="{{ path('physique_index') }}"class="btn btn-primary" id="index">Liste</a>
<div class="container">
            {# modal notification#}
            <div class="modal1 fade" id="modalNotif" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-sm" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body" id="body_notif">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
             </div>
        </div>

    <h2 id="information">Informations personnelles</h2>
    <div class="formulaire">
        {{ form_start(edit_form) }}
            {% if edit_form.nom is defined %}
                <div id="editform_mineur">
                {{ form_row(edit_form.mineur)}}
                </div>
            {% endif %}
        {# <div class="form-group col-md-6">
                <div id="editform_mineur">
                    {{ form_row(edit_form.mineur)}}
                </div>
            </div> #}
            <div class="form-row">
                <div class="form-group col-md-6">
                    {% if edit_form.nom is defined %}
                    {{form_row(edit_form.nom)}}
                    {% endif %}
                </div>
                <div class="form-group col-md-6">
                    {% if edit_form.prenom is defined %}
                    {{form_row(edit_form.prenom)}}
                    {% endif %}
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    {% if edit_form.sigle is defined %}
                    {{form_row(edit_form.sigle)}}
                    {% endif %}
                </div>
                    <div class="form-group col-md-6">
                    {% if edit_form.raisonSociale is defined %}
                    {{form_row(edit_form.raisonSociale)}}
                    {% endif %}
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    {{ form_row(edit_form.datnais)}}
                </div>
                <div class="form-group col-md-6">
                    {{ form_row(edit_form.telephone)}}
                </div>
            </div>
            <div class="form-group">
                {{ form_row(edit_form.email)}}
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    {{ form_row(edit_form.pays)}}
                </div>
                <div class="form-group col-md-6">
                    {{ form_row(edit_form.ville)}}
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <div id="tuteur">
                        {% if edit_form.tuteur is defined %}
                            {{form_row(edit_form.tuteur)}}
                        {% endif %}
                    </div>
                </div>
                <div class="form-group col-md-6">
                    <div id="prenom_tuteur">
                        {% if edit_form.prenomTuteur is defined %}
                            {{form_row(edit_form.prenomTuteur)}}
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="row foot">
                <input type="submit" class="btn btn-primary" id="valider" value="Valider" />
        {{ form_end(edit_form) }}
        {{ form_start(delete_form,{'attr':{'onSubmit':"return confirm('Voulez vous vraiment supprimer?');"}}) }}
                <input type="submit" class="btn btn-danger" id="supprimer" value="Supprimer">
        {{ form_end(delete_form) }} 
            </div>
    </div>
    <div class="piece">
    {# data-toggle="modal" #}
    <h2>Pièces jointes</h2>
    <a data-target="{{ path('piece_new') }}" data-tooltip="voir" id="ajout" {#data-toggle="modal"#} class="tooltipped modal-trigger" href="#myModal">{# <i class="fa fa-plus" style="font-size:26px" aria-hidden="true"></i>#} <i class="fa fa-plus-square" style="font-size:36px"></i> </a>
    {% if pieces is not null %}
                <table class="table table-striped table-hover table-sm table-responsive-lg thead-light" id="table">
                <thead>
                <tr>
                    <th>Id</th>
                    <th>Type Pièce</th>
                    <th>N° Pièce</th>
                    <th>Date Expiration</th>
                    <th>Date Déclaration</th>
                    <th>Date Délivrance</th>
                    <th>Emetteur</th>
                    <th>Pays d'émission</th>
                    <th>Fichier</th>
                    <th>Nom</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for piece in pieces %}
                <tr>
                    <td><a href="{{ path('piece_show', { 'id': piece.id }) }}" style="color:black;">{{ piece.id }}</a></td>
                    <td>{{ piece.typePiece }}</td>
                    <td>{{ piece.refPiece }}</td>
                    <td>{% if piece.datexpiration %}{{ piece.datexpiration|date('Y-m-d H:i:s') }}{% endif %}</td>
                    <td>{% if piece.datdeclaration %}{{ piece.datdeclaration|date('Y-m-d H:i:s') }}{% endif %}</td>
                    <td>{% if piece.datedelivrance %}{{ piece.datedelivrance|date('Y-m-d H:i:s') }}{% endif %}</td>
                    <td>{{ piece.emetteur }}</td>
                    <td>{{ piece.paysEmission }}</td>
                    <td><a href="{{ asset('uploads/brochures/' ~ piece.fichier) }}" style="color:skyblue">{{ piece.fichier }}</a></td>
                    <td>{{ piece.physique }}</td>
                    <td>
                        <ul>
                            {# <li>
                                <a href="{{ path('piece_show', { 'id': piece.id }) }}">show</a>
                            </li> #}
                                <a data-target="{{ piece.id}}" class="btn btn-info tooltipped modal-trigger1 ajout1" id="" data-toggle="modal" href="#myModal1">Modifier</a>
                            {# <a data-key="{{piece.id}}" class="btn btn-info modification" style="color:white;">Modifier</a> #}
                            {# href="{{ path('piece_edit', { 'id': piece.id }) }}" #}
                                {# {% include 'physique/delete.html.twig' %} #}
                                <form method="post" action="{{ path('piece_delete', {'id': piece.id}) }}" onsubmit="return confirm('Voulez vous vraiment supprimer?');">
                                    <input type="hidden" name="_method" value="DELETE">
                                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ piece.id) }}">
                                  
                                    <button class="btn btn-info" style="padding-left:9%; width:99.9%;margin-top:3%">Supprimer</button>
                                </form>
                        </ul>
                    </td>
                </tr>
            {% endfor %}
            </tbody> 
        </table>
        {% else %}
            <p>Aucune pièce trouvé!</p>
        {% endif %}
    
     {# modal #}
     <div class="modal fade modal1" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
     <div class="modal-dialog" role="document">
         <div class="modal-content">
              <div class="modal-header">
                 <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                 <span aria-hidden="true">&times;</span>
                 </button>
             </div>
             <div class="modal-body" id="body-edit1">
             </div>
             <div class="modal-footer">
                 <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
             </div>
         </div>
      </div>
 </div>

            <div class="modal fade modal2" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                         <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body" id="body-new">
                            {# {{render(controller('PieceBundle:Controller:PieceController::newAction'))}} #}
                             {# {% include 'piece/new.html.twig' %} #}
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                 </div>
            </div>
        </div>
    </div>
{% endblock %}    
{% block javascripts %} 
{{parent() }}

<script> 
     
$(document).ready(function(){

    $(".ajout1").click(function(){
        //ev.preventDefault();
        //On initialise les modales materialize
        //$('.modal1').modal();
        //On récupère l'url depuis la propriété "Data-target" de la balise html a
        const url = $(this).attr('data-target');
        const absUrl = "http://localhost/ouverture/web/app_dev.php/piece/"+url+"/edit"
        console.log(absUrl);
        
         $.ajax(
        {
            type: 'get', 
            url: absUrl,
            success: function (data) { 
               //console.log(data)
               $('#body-edit1').html(data)
               $('#myModal1').modal('show')

            },
            error: function (errorMessage) { 
            }
        }); 

        })
        })

        $(document).ready(function(){
    $(".modal-trigger").click(function(){
        
        $('.modal2').modal();
        
        url = $(this).attr('data-target');
        $.get(url, function (data) {
           
            $('#body-new').html(data);

            $('#myModal').modal('open');
        });

        })
    });
</script>   
{% endblock %}




{% extends 'base.html.twig' %}

{% block content %}
<style>
        body
            {
                font-family:  'Times New Roman';
                 /*font-family: Georgia, Times, 'Times New Roman', serif;*/
            }
        table{
                margin-top:2%;
            }
        .sidebar
            {
                background-color: teal;
                width: 100%;
                top: 0;
                left: 0;
                padding:1%;
                position:relative;
            }
        a
            {
                color:white;
                text-decoration: none;
            }
        a:hover
        {
            color:white;
            text-decoration:none;
        }
        .accueil
        {
            color:white;
            font-size:1.7rem;
        }
        #ouvrir
        {
            border:solid blue 0px;
            margin-left:75%;
            font-size:1.2rem;
            color:white;
        }
        #index
        {
            color: white;
            margin-left:94%;
        }
        #ouvrir:hover{
            color:white;
        }
        #liste{
            color:white;
            margin-top:10%;
            margin-left:85%;
        }
        .row
        { 
            margin-left:5%;
        }
        .container
        {
            font-size:1rem;
        }
        h2
        {
           /* height:15%;
            padding:1%;
            border:solid skyblue 1px;
            /*width:70%;*/
        }
        {# #supprimer
        {
            margin-left:92%;
        }
        #modifier{
            margin-top:5%;
            color:white;
            margin-left:93%; 
        } #}
        .fiche
        {
            border:solid rgb(192,192,192)0.5px;
            margin-right:16%;
            margin-top:4%;
            width:98%;
            height:58%;
            padding:2%;
            background-color:white;
        }
       

        .cl
        { 
            margin-left:1%;
            margin-top:0%;
        }
        .prenom
        {
            margin-left:0%;
        }
        strong
        {
            font-size:110%;
        }
        p
        {
            font-size:101%;
           
        }
        {# h2
        {
            /*font-size:170%;
            margin-left:16%;
            height:15%;
            padding:1%;
            border:solid skyblue 1px;
            width:70%;*/
           
        } #}
        .information
        {
            margin-top:8%;
           
        }
        #piece{
            margin-top:4%;
            
        }
        center{
            margin-top:2%;
        }
        #notification
            {
               margin-left:9%;
            }
      
        
        {#.sup
        {
            margin-top:0.30%;
            margin-right:30%;
        } #}
        {# #table
        {
            width:50%;
            margin:25px 40px 75px 80px;

        } #}
        li
        {
            display:inline-block;
        }
        tr
            {
                font-size:95%;
                text-align:center;
            }
        td {
            text-align:center;
        }

        .actions
        {
            margin-left:80%;
        }
        .sup
        {   
            margin-left:25%
        }
</style>

    {% block sidebar %}
        <div class="sidebar">
            <div class="row cl">
                <div class="col-md-2">
                    <a href="{{path('path_home')}}" class="accueil">Accueil</a>
                </div>
                <div class="col-md-4">
                <a data-target="{{ path('physique_showMessage', { 'id': physique.id }) }}" data-tooltip="voir" class="tooltipped modal-trigger btn btn-outline-light my-6 my-sm-6" href="#modalNotif" id="notification" data-toggle="modal"><i class="fa fa-bell"></i><span class="badge" style="position: absolute;
                top: -10px;padding: 5px 10px;border-radius: 50%;background:red;color: white;" id="notific">{{ comptesNotifs }}</span></a>
                    {# <button type="button" class="btn btn-outline-light my-6 my-sm-6" id="notification" data-toggle="modal"><i class="fa fa-bell"></i><span class="badge" style="position: absolute;
                    top: -10px;padding: 5px 10px;border-radius: 50%;background:red;color: white;" id="notific"></span></button> #}
                </div>
                <div class="col-md-6">
                    <a href="{{ path('path_choix')}}" id="ouvrir">Ouvrir un compte</a>
                </div>
            </div>
        </div>
    {% endblock %}

{# <a href="{{ path('physique_index') }}" class="btn btn-primary" id="liste">Retourner à la liste</a> #}
<div class="container">

            <div class="modal1 fade" id="modalNotif" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-sm" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body" id="body_notif">        
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                 </div>
            </div>

    <div class="row ">
    {% if physique.nom is null %}
            <div class="col-12">
                <div class="information"><h2>Informations personnelles</h2></div>
                <hr></hr>
                <div class="fiche">
                    <div class="row">
                        <div class="col-md-6"><p><strong>Sigle:</strong>    {{ physique.sigle }}</p></div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 prenom"><p><strong>Raison sociale:</strong>    {{ physique.raisonSociale }}</p></div>
                        <div class="col-md-6 "><p><strong>Date de naissance:</strong>    {% if physique.datnais %}{{ physique.datnais|date('Y-m-d') }}{% endif %}</p></div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 "><p><strong>Telephone:</strong>    {{  physique.telephone }}</p></div>
                        <div class="col-md-6 "><p><strong>Email:</strong>    {{ physique.email }}</p></div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 "><p><strong>Pays:</strong>    {{  physique.pays }}</p></div>
                        <div class="col-md-6 "><p><strong>Ville:</strong>    {{ physique.ville }}</p></div>
                    </div>
                </div>
            </div>
    {% else %}
        <div class="col-12">
            <div class="information"><h2>Informations personnelles</h2></div>
            <hr></hr>
            <div class="fiche">
                <div class="row">
                    <div class="col-md-6"><p><strong>Nom:</strong>    {{ physique.nom }}</p></div>
                </div>
                <div class="row">
                    <div class="col-md-6 prenom"><p><strong>Prénom:</strong>    {{ physique.prenom }}</p></div>
                    <div class="col-md-6 "><p><strong>Date de naissance:</strong>    {% if physique.datnais %}{{ physique.datnais|date('Y-m-d') }}{% endif %}</p></div>
                </div>
                <div class="row">
                    <div class="col-md-6 "><p><strong>Telephone:</strong>    {{  physique.telephone }}</p></div>
                    <div class="col-md-6 "><p><strong>Email:</strong>    {{ physique.email }}</p></div>
                </div>
                <div class="row">
                    <div class="col-md-6 "><p><strong>Pays:</strong>    {{  physique.pays }}</p></div>
                    <div class="col-md-6 "><p><strong>Ville:</strong>    {{ physique.ville }}</p></div>
                </div>
                <div class="row">
                    <div class="col-md-6 "><p><strong>Tuteur:</strong>    {{  physique.tuteur }}</p></div>
                    <div class="col-md-6 "><p><strong>Prénom du tuteur:</strong>    {{ physique.prenomTuteur }}</p></div>
                </div>
            </div>
        </div>
    {% endif %}
    </div>

    <div class="row">
        <div class="col-12">
                <div id="piece"><h2>Pièces jointes</h2></div>
                <hr></hr>
                {% if pieces is not null %}
                <div id="tableau">
                    <table class="table table-striped table-hover table-responsive-lg table-sm thead-light" id="table">
                        <thead>
                            <tr>
                                <th>Type Pièce</th>
                                <th>N° Pièce</th>
                                <th>Date Expiration</th>
                                <th>Date Déclaration</th>
                                <th>Date Délivrance</th>
                                <th>Emetteur</th>
                                <th>Pays d'émission</th>
                                <th>Fichier</th>
                                <th>Nom</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for piece in pieces %}
                            <tr>
                                <td>{{ piece.id }}</td>
                                <td>{{ piece.typePiece }}</td>
                                <td>{{ piece.refPiece }}</td>
                                <td>{% if piece.datexpiration %}{{ piece.datexpiration|date('Y-m-d H:i:s') }}{% endif %}</td>
                                <td>{% if piece.datdeclaration %}{{ piece.datdeclaration|date('Y-m-d H:i:s') }}{% endif %}</td>
                                <td>{% if piece.datedelivrance %}{{ piece.datedelivrance|date('Y-m-d H:i:s') }}{% endif %}</td>
                                <td>{{ piece.emetteur }}</td>
                                <td>{{ piece.paysEmission }}</td>
                                <td><a href="{{ asset('uploads/brochures/' ~ piece.fichier) }}" style="color:skyblue">{{ piece.fichier }}</a></td>
                                <td>{{ piece.physique }}</td>
                                <td>
                                    <ul>
                                        <li>
                                            <a data-key="{{piece.id}}"  class="btn btn-info view" style="color:white;">Voir</a>
                                        </li>
                                        {# <li> 
                                            {{ form_start(delete_form,{'attr':{'onSubmit':"return confirm('Voulez vous vraiment supprimer?');"}}) }}
                                                <input type="submit" class="btn btn-danger" id="supprimer" value="Supprimer">
                                            {{ form_end(delete_form) }}
                                        </li> #}
                                    </ul>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody> 
                    </table>
        
                {% else %}
                    <p>Aucune pièce trouvé!</p>
                {% endif %}
                </div>
        </div>
    </div>

    <!-- modal-->
    <div class="modal fade" id="modalShow" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="body_show">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
    </div>
        <div class="row actions">
            <div class="col-2">
                {% if physique.nom is null %}
                    <a href="{{ path('physique_edit', { 'id': physique.id ,'slug':2})}}" id="modifier" class="btn btn-primary">Modifier</a>
                {% else %}
                    <a href="{{ path('physique_edit', { 'id': physique.id ,'slug':1})}}" id="modifier" class="btn btn-primary">Modifier</a>
                {% endif %}
            </div>
            <div class="col-2 sup">
                {{ form_start(delete_form,{'attr':{'onSubmit':"return confirm('Voulez vous vraiment supprimer?');"}}) }}
                        <input type="submit" class="btn btn-danger" id="supprimer" value="Supprimer">
                {{ form_end(delete_form) }}
            </div>
        </div>
{% endblock %}


{% block javascripts %}
    {{ parent()}}
        <script>
            $(document).ready(function(e)
            {
                $(".view").click(function(ev){
                    ev.preventDefault();
                    let id = $(this).attr("data-key")
                    let data = {
                        id: id
                    }
                    console.log(data)
                    const url = Routing.generate('piece_show');
                    $.ajax(url, 
                    {
                        dataType: 'text', 
                        data: data,
                        success: function (data) { 
                          
                           console.log(data)
                           $('#body_show').html(data)
                           $('#modalShow').modal('show')

                        },
                        error: function (errorMessage) { 
                        }
                    });
                })
            })

        </script>
{% endblock %}
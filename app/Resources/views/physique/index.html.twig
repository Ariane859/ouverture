{% extends 'base.html.twig' %}

{% block content %}
<style>
        body
            {
                font-family: 'Times New Roman'
            }
        .sidebar
            {
                background-color: teal;
                width: 100%;
                top: 0;
                left: 0;
                padding:1%;
            }
        h1
            {
                margin-top:1%;
                font-weight:bold;
                font-size:2.5rem;
            }
        a
            {
                color:black;
                text-decoration: none;
            }
        a:hover
            {
                color:black;
                text-decoration:none;
            }
        .accueil
            {
                color:white;
                font-size:1.7rem;
            }
         .accueil:hover
            {
                color:white;
            }
        #ouvrir
            {
                margin-left:69%;
                font-size:1.2rem;
                color:white;
            }
         #ouvrir:hover
            {
                color:white;
            }
        #ajouter
            {
                margin-left:99%;
            }
        #bouton_search
            {
               
            }
        #tab
            {
                /*margin-top:3%;*/
                margin:auto:
                
            }
        tr
            {
                font-size:90%;
                text-align:center;
            }
        td {
            text-align:center;
        }
        #notification:hover
        {
            background:white;
        }
        #notification
        {
            margin-left:150%;
        }
</style>

    {% block sidebar %}
    <div class="sidebar">
        <div class="form-row">
            <div class="col-md-2">
                <a href="{{path('path_home')}}" class="accueil">Accueil</a>
            </div>
            <div class="col-md-4">
                <button type="button" class="btn btn-outline-light my-6 my-sm-6" id="notification" data-toggle="modal"><i class="fa fa-bell"></i><span class="badge" style="position: absolute;
                top: -10px;padding: 5px 10px;border-radius: 50%;background:red;color: white;" id="notific"></span></button>
            </div>
            <div class="col-md-4">
                <a href="{{ path('path_choix')}}" id="ouvrir">Ouvrir un compte</a>
            </div>
            <div class="col-md-2">
                <button type="button" class="btn btn-outline-light" id="bouton_search" data-toggle="modal"><i class="fa fa-search"></i></button>
            </div>
        </div>
    </div>
    
    {% endblock %}
    <div class="container">
            {# modal recherche #}
            <div class="modal fade" id="modalResult" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Recherche</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="formulaire">
                                <input class="form-control" type="text" placeholder="Search" id="search">
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary"id="valider">Valider</button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                 </div>
            </div>
            {# modal notification#}
             <div class="modal fade" id="modalNotif" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-sm" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body" id="body_notif">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                 </div>
            </div>
        <div class="row">
            <h1>Listes</h1>
            <div class="col-lg-12">
            {# <a href="{{ path('physique_new', {'slug':1}) }}" class="btn btn-primary" id="ajouter">Ajouter</a></div> #}
                <table class="table table-hover table-bordered table-responsive-lg" id="tab">
                    <thead class="thead-light">
                        <tr>
                            <th>Id</th>
                            <th>Nom</th>
                            <th>Prénom</th>
                            <th>Sigle</th>
                            <th>Raison sociale</th>
                            <th>Date de naissance</th>
                            <th>Telephone</th>
                            <th>Email</th>
                            <th>Pays</th>
                            <th>Ville</th>
                            <th>Tuteur</th>
                            <th>Prénom du tuteur</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="body">
                    {% for physique in physiques %}
                        <tr>
                            <th><a href="{{ path('physique_show', { 'id': physique.id }) }}">{{ physique.id }}</a></th>
                            <td>{{ physique.nom }}</td>
                            <td>{{ physique.prenom }}</td>
                            <td>{{ physique.sigle }}</td>
                            <td>{{ physique.raisonSociale }}</td>
                            <td>{% if physique.datnais %}{{ physique.datnais|date('Y-m-d') }}{% endif %}</td>
                            <td>{{ physique.telephone }}</td>
                            <td>{{ physique.email }}</td>
                            <td>{{ physique.pays }}</td>
                            <td>{{ physique.ville }}</td>
                            <td>{{ physique.tuteur }}</td>
                            <td>{{ physique.prenomTuteur }}</td>
                            <td>
                                <a href="{{ path('physique_show', { 'id': physique.id }) }}"class="btn btn-info" style="color:white">Voir</a>
                                {# <i class="fa fa-eye" style="font-size:23px;color:blue"></i> #}
                                {% if physique.nom is null %}
                                    <a href="{{ path('physique_edit', { 'id': physique.id, 'slug':2 }) }}" class="btn btn-primary" style="margin-top:1%;color:white">Edit</a>
                                    {# <i class="fa fa-edit" style="font-size:24px;color:blue"></i> #}
                                {% else %}
                                    <a href="{{ path('physique_edit', { 'id': physique.id, 'slug':1 }) }}" class="btn btn-primary" style="margin-top:1%;color:white">Edit</a>
                                    {# <i class="fa fa-edit" style="font-size:24px;color:blue"></i> #}
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %} 

    {{parent() }}

    <script> 
        
    $(document).ready(function(){
        $('#tab').DataTable({searching:false}); 
        $("#bouton_search").click(function(ev){
            ev.preventDefault();
            $('#search').val("")
            $('#modalResult').modal('show')
            $("#valider").click(function(ev){
            ev.preventDefault();
            let rechercher= $("#search").val();
            const data = { 
                search: rechercher 
            };
            const url = Routing.generate('physique_search');
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
            .then(response => response.text())
            .then(data => {
                $('#body').html(data)
                //$('#modal_body').html(data)
                //$('#modalResult').modal('show')
                //console.log('Success:', data);  
            })
                $('#modalResult').modal('hide')
            })
            /*.catch((error) => {
                console.error('Error:', error);
            }); */

        });
    })

    $(document).ready(function(){
    var notifications= new Array()
    notifications.push('Votre pièce est expirée', 'Veuillez changer vos pièces', 'Votre numéro de pièce est invalide', 'Votre passeport expire bientot','tadam!!!!')
    var count=notifications.length;
        $('#notific').html(count)
        $("#notification").click(function(ev){
            ev.preventDefault();
            document.getElementById('body_notif').innerHTML ="";
            for(let i of notifications)
            {
                //$('#body_notif').html(i)
    document.getElementById('body_notif').innerHTML += i + '<br><hr></hr>';
            }
            
            $('#modalNotif').modal('show')
        });
    })

    </script>   
{% endblock %}